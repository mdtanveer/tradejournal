{% extends "layout.html" %}

{% block content %}
<div class="container">
<ul class="nav nav-tabs justify-content-center">
    <li id="all" class="nav-item">
        <a class="nav-link {{"active" if subpage=="all" else ""}}" href="home?subpage=all&per_page=100">All</a>
    </li>
    <li id="open" class="nav-item">
        <a class="nav-link {{"active" if subpage=="open" else ""}}" href="home?subpage=open">Open</a>
    </li>
    <li id="close" class="nav-item">
        <a class="nav-link {{"active" if subpage=="closed" else ""}}" href="home?subpage=closed">Closed</a>
    </li>
    {% for cat in categories %}
    <li id="{{ cat }}" class="nav-item">
        <a class="nav-link {{"active" if subpage=="{{ cat }}" else ""}}" href="home?subpage={{ cat }}">{{ cat.title() }}</a>
    </li>
    {% endfor %}
</ul>
{% if journalentries %}
    <ul class="list-group checked-list-box">
        {% for journalentry in journalentries %}
            {% if journalentry.is_group() %}
            <li class="list-group-item">
                    <span>
                        <input class="form-check-input" type="checkbox" id="{{journalentry.key}}" aria-label="..."/>
                        <i class="bi-basket" style="font-size: 1rem;"></i>
                        <a href="/journalentrygroup/{{journalentry.key}}/view">{{journalentry.name}}</a>
                        <button class="btn-light" onclick="appendToClipboard(event, '{{journalentry.key}}')"><i class="bi-clipboard"></i></button>
                    </span>
                    <div class="text-muted panel-text ms-4" oncopy="clearLocalStorage()">
                        <div><i>entered {{journalentry.get_entry_time()}}</i></div>
                        <div><i>{{ journalentry.strategy.lower()}}</i></div>
                    </div>
                    <div class="ms-4">
                        <a href="/journalentrygroup/{{journalentry.key}}/edit"><i>{{ journalentry.get_comment_count()}} comments,</i></a>
                        <i>{{ journalentry.get_item_count() }} trades </i>
                    </div>
            </li>
             {% else %}
             <li class="list-group-item">
                 <input class="form-check-input" type="checkbox" id="{{journalentry.key}}" aria-label="..."/>
                <span class="">
                    {%if not not journalentry.is_idea%}
                        <i class="bi-lightbulb text-warning" style="font-size: 1rem;"></i>
                    {%else%}
                        {%if journalentry.is_open()%}
                            <i class="bi-play-circle" style="font-size: 1rem;"></i>
                        {%else%}
                            {%if journalentry.is_profitable()%}
                                <i class="bi-arrow-up-circle text-success" style="font-size: 1rem;"></i>
                            {%else%}
                                <i class="bi-arrow-down-circle text-danger" style="font-size: 1rem;"></i>
                            {%endif%}
                        {%endif%}
                    {%endif%}
                    <a href="/journalentry/{{journalentry.key}}/charts">{{journalentry.symbol}}</a>
                    <button class="btn-light" onclick="appendToClipboard(event, '{{journalentry.key}}')"><i class="bi-clipboard"></i></button>
                </span>
                <div class="text-muted panel-text ms-4" oncopy="clearLocalStorage()">
                    <div><i>entered {{journalentry.get_entry_time()}}</i></div>
                    <div><i>{{ journalentry.direction.lower()}},&nbsp;{{ journalentry.strategy.lower()}},&nbsp;{{ journalentry.timeframe.lower()}}</i></div>
                    <div><small> <i>{{ journalentry.tradingsymbol}}</i></small></div>
                </div>
             </li>
             {% endif %}
        {% endfor %}
</ul>
<div class="d-flex pagination-sm flex-sm-wrap">
        {{ pagination.links }}
</div>
    <script>
        function appendToClipboard(event, text){
            groupItems = localStorage.getItem("groupItems");
            if (!event.shiftKey && groupItems != "") {
                localStorage.setItem("groupItems", groupItems+ ',' + text);
            } else {
                localStorage.setItem("groupItems", text);
            }
        }
        
        function clearLocalStorage(){
            localStorage.setItem("groupItems", "");
        }
        function postCheckedItems() {
            var checkedItems = [];
            var checkboxes = document.querySelectorAll('input[type="checkbox"]');
            
            checkboxes.forEach(function(checkbox) {
                if (checkbox.checked) {
                    checkedItems.push(checkbox.id);
                }
            });
            
            // Convert the checkedItems array to a URL query string
            var queryString = checkedItems.map(item => encodeURIComponent(item)).join(',');

            // Navigate to the URL with the checked items as parameters
            window.location.href = "creategroup?createwith=" + queryString;
        }

        function clearCheckboxes() {
            var checkboxes = document.querySelectorAll('input[type="checkbox"]');
            
            checkboxes.forEach(function(checkbox) {
                checkbox.checked = false;
            });

            clearLocalStorage();
        }
    </script>
{% else %}
<p>No journalentries available.</p>
<br />
{% endif %}
<br/>
    <div>
        <button class="btn btn-light btn-secondary" onclick="postCheckedItems()">Create Group</button>
        <button class="btn btn-light btn-secondary" onclick="clearCheckboxes()">Clear</button>
    </div>
</div>
{% endblock %}
